<!DOCTYPE html>
<html lang="en">
<!-- 
1) Some stuff requires you to check the generated elements from datatables cuz they are only generated by datatables

2) May take awhile to understand what I've added, but do lemme know if theres any issues

3) To start frontend, npx http-server. To start backend, npm start (its actually being hosted on port:3000!)

4) dataviewer.html renamed to index.html

Issues:
- Can't get response out of axios function

- Pagination responsiveness(i'm on it)

- Your(Kelyn) filters no longer work :( but theres a specific comment inside to help u tho! -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Viewer</title>
    <!--JQuery -> For Javascript implementation! -->
    <script src="https://code.jquery.com/jquery-3.5.0.min.js" type="text/javascript"></script>
    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
        integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
        crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
        integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
    <!-- Font awesome - For icons used in sidebar-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!--CSS-->
    <link rel="stylesheet" href="stylesheet.css">
    <!-- Bootstrap Datatables Imports -->
    <link rel="stylesheet" type="text/css"
        href="https://cdn.datatables.net/v/dt/dt-1.10.20/sp-1.0.1/r-2.2.3/sl-1.3.1/datatables.min.css" />

    <script type="text/javascript"
        src="https://cdn.datatables.net/v/dt/dt-1.10.20/sp-1.0.1/r-2.2.3/sl-1.3.1/datatables.min.js"></script>

    <!-- Axios -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

</head>

<body>
    <script>
        var paginationIndex = 0; //0 being the first page
        const baseUrl = "http://localhost:3000";

        //Every single script will only run once the DOM is ready!
        $(document).ready(function () {
            var table = $('#theTable').DataTable({ //Renamed the table to literally, theTable.
                "columns": [
                    { data: 'adtypename' },
                    { data: 'optionid' },
                    { data: 'companyid' },
                    { data: 'audiencereach' },
                    { data: 'cost' },
                ],
                "scrollX": true,
                "scrollY": "50vh",
                "scrollCollapse": true,
                responsive: true,
                // The DOM model for the table are only modeled at t,l.
                // Legend~
                // l - length
                // f -filter
                // t - table 
                // i - information 
                // p - pagination 
                // r - processing 
                // <> - div elements   
                // <"#id" > -div with an id 
                // <"class" > div with a class
                // <"#id.class" div with an id and class
                dom: '<"#tableContainer"<"#tableArea"t><"#paginationArea"l>>',
                // Only tableArea will have flex, paginationArea won't. Thus the written DOM.
                "lengthMenu": [[5, 10, 20, 30, 40, 50, -1], [5, 10, 20, 30, 40, 50, "All"]]
            });

            // Kelyn's filtering. (FIXING REQUIRED)
            // the datatables "columns" was changed from name: (column name) to data: (column name)
            $('.dataTables_length').addClass('bs-select');
            table.column('.companyid:name').every(function () {
                var that = this;
                $('.companyidInput:name').on('keyup', function () {
                    var value = $(this).val();
                    console.log('this ', value);
                    if (that.search() !== value) {
                        that.search(value).draw();
                    }
                });
            });

            table.column('.audiencereach').every(function () {
                var that = this;
                $('.audiencereachInput').on('keyup', function () {
                    var value = $(this).val();
                    console.log('this ', value);
                    if (that.search() !== value) {
                        that.search(value).draw();
                    }
                });
            });

            
            // Pagination algorithm:
            // Sample paginate_button generated.
            // <a class="paginate_button" id="paginate_button" tabindex="0"</a> tabindex is very important here, it affects the index overflow part for the next button.
            var openingTag = '<a class="paginate_button" id="paginate_button" tabindex="';
            var middleTag = '">'
            var closingTag = '</a>'
            var elipsis = '<a class="ellipsis">…</a>'

            var pageSize = table.page.info().length; //Derives the pageSize from datatables

            axios.get(`${baseUrl}/extra/getRowCount`)
                .then((response) => {
                    var parse = response.data[0].count;
                    var final = Math.floor(parse / pageSize) + 1; //This is the pagination algo
                    $(".pageNumbers").empty();
                    if (final <= 5 && final != 1) {
                        for (i = 1; i < final; i++) {
                            $(".pageNumbers").append(openingTag + (i) + middleTag + (i + 1) + closingTag);

                        }
                    } else if (final > 5) { //This is when pages increment above 5, still in testing phase.
                        for (i = 1; i <= 4; i++) {
                            $(".pageNumbers").append(openingTag + (i) + middleTag + (i + 1) + closingTag);
                        }
                        $(".finalPageNumber").append(elipsis + openingTag + (final - 1) + middleTag + (final) + closingTag);
                    }
                });

            // Retrieve ROW DATA from database based on limit(pageSize) and offset(pageNo * pageSize) values
            const pageNo = paginationIndex;
            const requestBody = {
                pageNo: pageNo,
                pageSize: pageSize
            };
            axios.post(`${baseUrl}/basic/Alldata`, requestBody)
                .then((response) => {
                    var data = response.data;
                    table.clear();
                    data.forEach((param) => {
                        table.row.add(param).draw()
                    });
                });

            // Click stuff:
            // On Click previous button
            $(document).on('click', '#theTable_previous', function () {
                if (paginationIndex != 0) {
                    paginationIndex -= 1;
                    console.log(paginationIndex);
                    const pageNo = paginationIndex;
                    const requestBody = {
                        pageNo: pageNo,
                        pageSize: pageSize
                    };
                    axios.post(`${baseUrl}/basic/Alldata`, requestBody)
                        .then((response) => {
                            var data = response.data;
                            table.clear();
                            data.forEach((param) => {
                                table.row.add(param).draw()
                            });
                        });
                }
            });

            // On Click next button
            $(document).on('click', '#theTable_next', function () {
                var array = []; //the TabIndex of paginate_buttons generated are taken in to get the highest index
                var lastPage;
                $(".paginate_button").each(function () {
                    array.push(parseInt($(this).attr('tabIndex')))
                })
                lastPage = Math.max(...array);
                if (paginationIndex < lastPage) {
                    paginationIndex += 1;
                    const pageNo = paginationIndex;
                    const requestBody = {
                        pageNo: pageNo,
                        pageSize: pageSize
                    };
                    axios.post(`${baseUrl}/basic/Alldata`, requestBody)
                        .then((response) => {
                            var data = response.data;
                            table.clear();
                            data.forEach((param) => {
                                table.row.add(param).draw()
                            });
                        });
                }
            });

            //On change of pageSize - [The show (how many) entries part]
            $("[name='theTable_length'").change(function () {
                const pageSize = table.page.info().length;

                // Pagination algorithm:
                var openingTag = '<a class="paginate_button" id="paginate_button" tabindex="';
                var middleTag = '">'
                var closingTag = '</a>'
                var elipsis = '<a class="ellipsis">…</a>'

                axios.get(`${baseUrl}/extra/getRowCount`)
                    .then((response) => {
                        var parse = response.data[0].count;
                        var final = Math.floor(parse / pageSize) + 1; //This is the pagination algo
                        $(".pageNumbers").empty(); //Empties the class so it can append and work its magic
                        if (final <= 5 && final != 1) {
                            for (i = 1; i < final; i++) {
                                $(".pageNumbers").append(openingTag + (i) + middleTag + (i + 1) + closingTag);
                            }
                        } else if (final > 5) {
                            for (i = 1; i <= 4; i++) {
                                $(".pageNumbers").append(openingTag + (i) + middleTag + (i + 1) + closingTag);
                            }
                            $(".finalPageNumber").append(elipsis + openingTag + (final - 1) + middleTag + (final) + closingTag);
                        }
                    });

                // Retrieve data from database based on limit(pageSize) and offset(pageNo * pageSize) values
                const pageNo = paginationIndex;
                const requestBody = {
                    pageNo: pageNo,
                    pageSize: pageSize
                };
                axios.post(`${baseUrl}/basic/Alldata`, requestBody)
                    .then((response) => {
                        var data = response.data;
                        table.clear();
                        data.forEach((param) => {
                            table.row.add(param).draw()
                        });
                    });
                
                paginationIndex = 0; //Sets back to page 1.(Highly important)
                //The table doesnt update immediately though, thinking of forcing button click on element
            });



            //This specific onclick settles all pagination numbers
            $(document).on('click', '#paginate_button', function () {
                var pageNumberClicked = ($(this).closest("#paginate_button"));
                paginationIndex = pageNumberClicked[0].tabIndex;

                console.log(paginationIndex);

                // Retrieve data from database based on limit(pageSize) and offset(pageNo * pageSize) values
                const baseUrl = "http://localhost:3000";
                const pageNo = paginationIndex;
                const pageSize = table.page.info().length;
                const requestBody = {
                    pageNo: pageNo,
                    pageSize: pageSize
                };
                axios.post(`${baseUrl}/basic/Alldata`, requestBody)
                    .then((response) => {
                        var data = response.data;
                        table.clear();
                        data.forEach((param) => {
                            table.row.add(param).draw()
                        });

                    });

                //Pagination algorithm:
                var openingTag = '<a class="paginate_button" id="paginate_button" tabindex="';
                var middleTag = '">'
                var closingTag = '</a>'
                var elipsis = '<a class="ellipsis">…</a>'

                axios.get(`${baseUrl}/extra/getRowCount`)
                    .then((response) => {
                        var parse = response.data[0].count;
                        var final = Math.floor(parse / pageSize) + 1; //This is the pagination algo

                        $(".pageNumbers").empty();

                        if (final <= 5 && final != 1) {
                            for (i = 1; i < final; i++) {
                                $(".pageNumbers").append(openingTag + (i) + middleTag + (i + 1) + closingTag);
                            }
                        } else if (final > 5) {
                            for (i = 1; i <= 4; i++) {
                                $(".pageNumbers").append(openingTag + (i) + middleTag + (i + 1) + closingTag);
                            }
                            $(".finalPageNumber").append(elipsis + openingTag + (final - 1) + middleTag + (final) + closingTag);
                        }
                    });
            });
        });
    </script>

    <div class="container-fluid">
        <div class="row" id="rows">
            <!-- Row 1 -->
            <div class="bg-dark" id="row1">
                <div class="wrapper">
                    <!-- Sidebar -->
                    <nav id="sidebar">
                        <div class="sidebar-header">
                            <h3>Logo Space</h3>
                        </div>
                        <ul class="list-unstyled components">
                            <li class="active nav-item">
                                <a class="nav-link" href="dataViewer.html"><i class="fa fa-table"></i> Data Viewer</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="resultsPage.html"><i class="fa fa-bar-chart"></i> Results</a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
            <!-- Row 2 -->
            <div class="bg-white" id="row2">
                <div class="titleBox" id="titleBox">
                    <h1>Data Viewer</h1>
                </div>
                <div class="filterArea" id="filterArea">
                    <h2>Filter by:</h2>
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text"><i class="fa fa-building"></i></span>
                        </div>
                        <input type="text" placeholder="CompanyId" class="form-control companyidInput">
                        <div class="input-group-prepend">
                            <span class="input-group-text"><i class="fa fa-user"></i>
                        </div>
                        <input type="text" placeholder="Audience reach" class="form-control audiencereachInput">
                    </div>
                </div>
                <!-- Table -->
                <table id="theTable" class="responsive nowrap display table-bordered table-striped " style="width:100%">
                    <thead>
                        <tr>
                            <th class="th-sm">s/n
                            </th>
                            <th class="th-sm">Option ID
                            </th>
                            <th class="th-sm">Company ID
                            </th>
                            <th class="th-sm">Audience reach
                            </th>
                            <th class="th-sm">Cost
                            </th>
                        </tr>
                    </thead>
                    <tbody class='myTable'>

                    </tbody>
                </table>

                <div class="pagination" id="pagination">
                    <a class="paginate_button previous disabled" tabindex="-1"
                        id="theTable_previous">Previous</a>
                    <a class="paginate_button current" id="paginate_button" tabindex="0">1</a>
                    <div class="pageNumbers"></div>
                    <div class="finalPageNumber"></div>
                    <a class="paginate_button next" tabindex="0" id="theTable_next">Next</a>

                </div>

            </div>
        </div>
    </div>
</body>

</html>